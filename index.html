<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Brian's Ideas ‚Äî Kanban Board</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
  
  * { margin: 0; padding: 0; box-sizing: border-box; }
  
  body {
    background: #0a0a0a;
    font-family: 'Inter', -apple-system, sans-serif;
    color: #fff;
    min-height: 100vh;
    padding: 24px;
  }

  .header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 24px;
    flex-wrap: wrap;
    gap: 12px;
  }
  .header h1 { font-size: 28px; font-weight: 800; }
  .header .subtitle { color: #666; font-size: 13px; margin-top: 4px; }
  .header-actions { display: flex; gap: 8px; }
  
  .btn {
    background: #1a1a1a;
    border: 1px solid #333;
    color: #fff;
    padding: 8px 16px;
    border-radius: 8px;
    font-size: 13px;
    font-weight: 600;
    cursor: pointer;
    font-family: inherit;
    transition: all 0.15s;
  }
  .btn:hover { background: #222; border-color: #444; }
  .btn-primary {
    background: linear-gradient(135deg, #f97316, #ef4444);
    border: none;
  }
  .btn-primary:hover { opacity: 0.9; }
  .btn-danger { background: #2a1a1a; border-color: #f87171; color: #f87171; }
  .btn-danger:hover { background: #3a1a1a; }
  .btn-sm { padding: 5px 10px; font-size: 11px; }

  .board {
    display: flex;
    gap: 16px;
    overflow-x: auto;
    padding-bottom: 24px;
    align-items: flex-start;
  }

  .column {
    min-width: 300px;
    max-width: 300px;
    background: #111;
    border-radius: 12px;
    border: 1px solid #1a1a1a;
    flex-shrink: 0;
  }
  .column-header {
    padding: 16px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    border-bottom: 1px solid #1a1a1a;
  }
  .column-title {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 14px;
    font-weight: 700;
  }
  .column-count {
    background: #222;
    color: #888;
    font-size: 11px;
    font-weight: 700;
    padding: 2px 8px;
    border-radius: 10px;
  }
  .column-body {
    padding: 8px;
    min-height: 60px;
  }

  /* Cards */
  .card {
    background: #1a1a1a;
    border: 1px solid #222;
    border-radius: 10px;
    padding: 14px;
    margin-bottom: 8px;
    cursor: grab;
    transition: all 0.15s;
    position: relative;
  }
  .card:hover {
    border-color: #333;
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  }
  .card:active { cursor: grabbing; }
  .card.dragging { opacity: 0.5; transform: rotate(2deg); }
  .card-emoji { font-size: 20px; margin-bottom: 8px; }
  .card-title { font-size: 14px; font-weight: 700; margin-bottom: 6px; }
  .card-desc { font-size: 12px; color: #888; line-height: 1.5; margin-bottom: 10px; }
  .card-tags { display: flex; flex-wrap: wrap; gap: 4px; }
  .card-revenue {
    font-size: 11px; color: #22c55e; font-weight: 600;
    margin-top: 8px; padding-top: 8px; border-top: 1px solid #222;
  }
  .card-sections-preview {
    display: flex; gap: 6px; margin-top: 8px; padding-top: 8px; border-top: 1px solid #222;
  }
  .section-badge {
    font-size: 9px; font-weight: 700; padding: 2px 6px;
    border-radius: 4px; text-transform: uppercase; letter-spacing: 0.3px;
  }
  .section-badge-todo { background: #1a2a1a; color: #4ade80; }
  .section-badge-idea { background: #2a2a1a; color: #fbbf24; }
  .section-badge-plan { background: #1a1a2e; color: #818cf8; }
  .section-badge-info { background: #1a2a2a; color: #22d3ee; }
  .section-badge-resources { background: #2a2018; color: #fb923c; }
  .section-badge-notes { background: #2a1a2a; color: #c084fc; }

  .tag {
    font-size: 10px; font-weight: 600; padding: 3px 8px;
    border-radius: 6px; text-transform: uppercase; letter-spacing: 0.3px;
  }
  .tag-re { background: #1a2a1a; color: #22c55e; }
  .tag-ai { background: #1a1a2e; color: #818cf8; }
  .tag-voice { background: #2a1a2a; color: #c084fc; }
  .tag-saas { background: #2a2a1a; color: #fbbf24; }
  .tag-game { background: #2a1a1a; color: #f87171; }
  .tag-coach { background: #1a2a2a; color: #22d3ee; }
  .tag-tool { background: #1a1a1a; color: #94a3b8; }

  .drop-zone {
    border: 2px dashed #333; border-radius: 10px;
    padding: 20px; text-align: center; color: #444;
    font-size: 12px; margin: 8px 0; transition: all 0.15s; display: none;
  }
  .drop-zone.active {
    display: block; border-color: #f97316; color: #f97316;
    background: rgba(249, 115, 22, 0.05);
  }

  /* Stats */
  .stats-bar { display: flex; gap: 16px; margin-bottom: 20px; flex-wrap: wrap; }
  .stat {
    background: #111; border: 1px solid #1a1a1a;
    border-radius: 10px; padding: 12px 20px; text-align: center;
  }
  .stat-value { font-size: 24px; font-weight: 800; }
  .stat-label { font-size: 10px; color: #666; text-transform: uppercase; letter-spacing: 0.5px; margin-top: 2px; }

  .updated { color: #444; font-size: 11px; text-align: right; margin-top: 16px; }

  /* ===== MODAL: Shared ===== */
  .modal-overlay {
    display: none; position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.75); z-index: 100;
    justify-content: center; align-items: flex-start;
    overflow-y: auto; padding: 40px 16px;
  }
  .modal-overlay.show { display: flex; }

  .modal {
    background: #111; border: 1px solid #222;
    border-radius: 16px; padding: 24px;
    width: 90%; max-width: 600px; position: relative;
  }
  .modal h2 { font-size: 18px; font-weight: 800; margin-bottom: 16px; }
  .modal input, .modal textarea, .modal select {
    width: 100%; background: #1a1a1a; border: 1px solid #333;
    color: #fff; padding: 10px 12px; border-radius: 8px;
    font-size: 14px; font-family: inherit; margin-bottom: 12px;
  }
  .modal textarea { min-height: 80px; resize: vertical; }
  .modal-actions { display: flex; justify-content: flex-end; gap: 8px; margin-top: 8px; }
  .modal-close {
    position: absolute; top: 16px; right: 16px;
    background: none; border: none; color: #666;
    font-size: 20px; cursor: pointer; padding: 4px;
  }
  .modal-close:hover { color: #fff; }

  /* ===== CARD DETAIL MODAL ===== */
  .detail-header {
    display: flex; align-items: center; gap: 12px; margin-bottom: 20px;
  }
  .detail-emoji { font-size: 36px; }
  .detail-title-wrap { flex: 1; }
  .detail-title {
    font-size: 22px; font-weight: 800; margin-bottom: 4px;
    background: none; border: none; color: #fff; padding: 0;
    font-family: inherit; width: 100%;
  }
  .detail-title:focus { outline: none; border-bottom: 1px solid #f97316; }
  .detail-column-badge {
    font-size: 11px; font-weight: 600; padding: 3px 10px;
    border-radius: 6px; display: inline-block;
  }
  .detail-desc {
    width: 100%; background: #0a0a0a; border: 1px solid #1a1a1a;
    color: #ccc; padding: 12px; border-radius: 8px;
    font-size: 13px; font-family: inherit; min-height: 60px;
    resize: vertical; margin-bottom: 20px; line-height: 1.6;
  }
  .detail-desc:focus { outline: none; border-color: #333; }

  /* Section Tabs */
  .section-tabs {
    display: flex; gap: 4px; margin-bottom: 16px;
    border-bottom: 1px solid #1a1a1a; padding-bottom: 8px;
    flex-wrap: wrap;
  }
  .section-tab {
    padding: 6px 14px; border-radius: 8px 8px 0 0;
    font-size: 12px; font-weight: 700; cursor: pointer;
    background: #0a0a0a; border: 1px solid #1a1a1a;
    border-bottom: none; color: #666; transition: all 0.15s;
    text-transform: uppercase; letter-spacing: 0.3px;
  }
  .section-tab:hover { color: #999; background: #111; }
  .section-tab.active { color: #fff; background: #1a1a1a; border-color: #333; }
  .section-tab.active[data-section="todo"] { color: #4ade80; }
  .section-tab.active[data-section="idea"] { color: #fbbf24; }
  .section-tab.active[data-section="plan"] { color: #818cf8; }
  .section-tab.active[data-section="resources"] { color: #fb923c; }
  .section-tab.active[data-section="info"] { color: #22d3ee; }
  .section-tab.active[data-section="notes"] { color: #c084fc; }

  .section-content { display: none; }
  .section-content.active { display: block; }

  /* Todo Section */
  .todo-list { list-style: none; margin-bottom: 12px; }
  .todo-item {
    display: flex; align-items: center; gap: 10px;
    padding: 8px 12px; background: #0a0a0a; border: 1px solid #1a1a1a;
    border-radius: 8px; margin-bottom: 6px; transition: all 0.15s;
  }
  .todo-item:hover { border-color: #333; }
  .todo-item.done { opacity: 0.5; }
  .todo-item.done .todo-text { text-decoration: line-through; }
  .todo-check {
    width: 18px; height: 18px; border-radius: 50%;
    border: 2px solid #333; background: none; cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    color: transparent; font-size: 11px; transition: all 0.15s;
    flex-shrink: 0;
  }
  .todo-check:hover { border-color: #4ade80; }
  .todo-check.checked { background: #4ade80; border-color: #4ade80; color: #000; }
  .todo-text { flex: 1; font-size: 13px; }
  .todo-delete {
    background: none; border: none; color: #444;
    cursor: pointer; font-size: 14px; padding: 2px 6px;
  }
  .todo-delete:hover { color: #f87171; }
  .add-todo {
    display: flex; gap: 8px;
  }
  .add-todo input {
    flex: 1; margin-bottom: 0;
  }

  /* Text Sections (idea, plan, info, notes) */
  .section-textarea {
    width: 100%; background: #0a0a0a; border: 1px solid #1a1a1a;
    color: #ccc; padding: 14px; border-radius: 8px;
    font-size: 13px; font-family: inherit; min-height: 150px;
    resize: vertical; line-height: 1.7;
  }
  .section-textarea:focus { outline: none; border-color: #333; }
  .section-textarea::placeholder { color: #333; }

  /* Tags + Revenue in detail */
  .detail-meta {
    display: flex; gap: 12px; margin-top: 20px; padding-top: 16px;
    border-top: 1px solid #1a1a1a; flex-wrap: wrap; align-items: center;
  }
  .detail-meta label { font-size: 11px; color: #666; font-weight: 600; text-transform: uppercase; }
  .detail-meta input { margin-bottom: 0; flex: 1; min-width: 150px; }
  .detail-meta select { margin-bottom: 0; width: auto; }

  .detail-footer {
    display: flex; justify-content: space-between; align-items: center;
    margin-top: 16px; padding-top: 16px; border-top: 1px solid #1a1a1a;
  }
</style>
</head>
<body>

<div class="header">
  <div>
    <h1>üß† Brian's Ideas Board</h1>
    <div class="subtitle">Click cards to expand ‚Ä¢ Drag between columns ‚Ä¢ All changes auto-save</div>
  </div>
  <div class="header-actions">
    <button class="btn" onclick="exportData()">üìã Export</button>
    <button class="btn btn-primary" onclick="openNewModal()">+ New Idea</button>
  </div>
</div>

<div class="stats-bar" id="stats"></div>
<div class="board" id="board"></div>
<div class="updated" id="updated"></div>

<!-- NEW IDEA MODAL -->
<div class="modal-overlay" id="newModal">
  <div class="modal">
    <button class="modal-close" onclick="closeNewModal()">‚úï</button>
    <h2>‚ú® New Idea</h2>
    <input type="text" id="newTitle" placeholder="Idea title...">
    <textarea id="newDesc" placeholder="Short description..."></textarea>
    <select id="newColumn">
      <option value="ideas">üí° Ideas</option>
      <option value="planning">üìã Planning</option>
      <option value="building">üî® Building</option>
      <option value="launched">üöÄ Launched</option>
    </select>
    <input type="text" id="newTags" placeholder="Tags (comma separated): ai, saas, voice, re, coach, game, tool">
    <input type="text" id="newRevenue" placeholder="Revenue potential (optional)">
    <div class="modal-actions">
      <button class="btn" onclick="closeNewModal()">Cancel</button>
      <button class="btn btn-primary" onclick="addIdea()">Add Idea</button>
    </div>
  </div>
</div>

<!-- CARD DETAIL MODAL -->
<div class="modal-overlay" id="detailModal">
  <div class="modal" style="max-width:700px;">
    <button class="modal-close" onclick="closeDetail()">‚úï</button>
    <div id="detailContent"></div>
  </div>
</div>

<script>
// ===== DATA =====
const SECTIONS = ['todo', 'idea', 'plan', 'resources', 'info', 'notes'];
const SECTION_LABELS = { todo: '‚úÖ Todo', idea: 'üí° Idea', plan: 'üìã Plan', resources: 'üîß Resources', info: '‚ÑπÔ∏è Info', notes: 'üìù Notes' };
const SECTION_PLACEHOLDERS = {
  idea: 'Describe the core idea... What problem does it solve? Who is it for?',
  plan: 'Outline the plan... What are the steps to build this? Architecture? Tech stack?',
  resources: 'What do you need to build this?\n\nAPIs & Services:\n- \n\nSkills & Knowledge:\n- \n\nCost / Budget:\n- \n\nPeople / Help:\n- \n\nTools & Infrastructure:\n- ',
  info: 'Reference links, resources, API docs, competitor analysis, research...',
  notes: 'Free-form notes, observations, meeting notes, feedback...'
};

const defaultData = {
  columns: {
    ideas: { title: 'üí° Ideas', color: '#fbbf24' },
    planning: { title: 'üìã Planning', color: '#3b82f6' },
    building: { title: 'üî® Building', color: '#f97316' },
    launched: { title: 'üöÄ Launched', color: '#22c55e' },
    onhold: { title: '‚è∏Ô∏è On Hold', color: '#666' }
  },
  cards: [
    {
      id: 'agent-assistant', column: 'planning', emoji: 'üè†',
      title: 'Agent Assistant App',
      desc: 'All-in-one AI assistant for real estate agents. MLS search, contracts, ShowingTime scheduling, voice notes, CRM updates, goal tracking. Modeled after OpenClaw architecture.',
      tags: ['re', 'ai', 'voice', 'saas'],
      revenue: '$50-100/mo per agent ‚Ä¢ 1% of 1.7M agents = $10-20M/yr',
      sections: {
        todo: [
          { text: 'Pick MVP features (goal tracker + daily accountability + schedule)', done: false },
          { text: 'Design voice interaction flow for post-showing notes', done: false },
          { text: 'Architect backend (Node.js + PostgreSQL)', done: false },
          { text: 'Build MVP', done: false },
          { text: 'Beta test with local agents', done: false }
        ],
        idea: 'Clone OpenClaw for real estate agents. Not just an app ‚Äî a full personal AI assistant built on OpenClaw\'s proven architecture.\n\nEach agent gets their own always-on assistant that knows their pipeline, remembers every client, and proactively keeps them on track.\n\nFeatures as Skills:\n- MLS login + search (Playwright)\n- Contract filling (CFill ‚Äî already built)\n- ShowingTime scheduling + route optimization\n- Post-showing voice notes ‚Üí CRM auto-update\n- CMA builder from MLS sheets\n- Follow Up Boss integration\n- Nearby listing alerts (1mi radius)\n- Professional listing websites\n- Daily/weekly/monthly goal tracking',
        plan: 'Architecture: OpenClaw Clone (Restricted + RE Skills)\n\nKeep: Gateway + agent, Memory system, Heartbeat, Skills framework, Channel support (SMS/WhatsApp), Cron jobs\nRemove: Shell access, code execution, server management\nAdd: MLS Skill, Contract Skill, ShowingTime Skill, CRM Skill, Goal Tracking Skill\n\nDelivery:\n- Each agent gets own instance (or multi-tenant)\n- Agents provide own API keys (Gemini, FUB, ShowingTime)\n- Brian hosts helpers on DO server\n- Web dashboard + phone channels',
        resources: 'APIs & Services:\n- OpenClaw (core architecture ‚Äî already have)\n- Deepgram STT (Nova-2 + Flux ‚Äî already integrated)\n- ElevenLabs TTS (already integrated)\n- OSRM routing API (free, no key)\n- Follow Up Boss API (per-agent key)\n- Google Maps API ($200/mo free credit)\n- Gemini API (per-agent key)\n\nInfrastructure:\n- DigitalOcean server (upgrade from $8/mo for multi-tenant)\n- Domain + SSL\n- PostgreSQL database\n\nExisting Tech (already built):\n- CFill contract filler ‚úÖ\n- ShowingTime Playwright automation ‚úÖ\n- Coaching app goal framework ‚úÖ\n- Route optimization ‚úÖ\n\nSkills & Knowledge:\n- Node.js / Express ‚úÖ\n- Playwright automation ‚úÖ\n- OpenClaw architecture ‚úÖ\n- MLS system access (need to research per-region)\n\nCost Estimate:\n- Server: ~$24-48/mo (bigger DO droplet)\n- APIs: mostly per-agent (they bring own keys)\n- Domain: ~$12/yr',
        info: 'Existing tech that feeds into this:\n- CFill contract filler (Playwright + FormSimplicity) ‚Äî DONE\n- ShowingTime booking automation (Playwright) ‚Äî DONE\n- Deepgram STT (Nova-2 + Flux) ‚Äî integrated\n- ElevenLabs TTS ‚Äî integrated\n- Coaching app goal framework ‚Äî DONE\n- Route optimization (OSRM API) ‚Äî tested\n\nMarket: 1.7M US agents, $50-100/mo subscription\nCompetitors: Point solutions but no true all-in-one AI assistant',
        notes: 'Brian\'s exact words: "I want to basically clone OpenClaw, restrict some of its abilities, and then add a specific set of skills that real estate agents can use."\n\nKey insight: Once an agent\'s data and workflow is in the system, switching cost is high = strong moat.'
      }
    },
    {
      id: 'showingtime-scheduler', column: 'launched', emoji: 'üó∫Ô∏è',
      title: 'ShowingTime Scheduler + Route Optimizer',
      desc: 'Route optimization + Playwright auto-schedules showings on ShowingTime. Agent inputs addresses ‚Üí gets optimal schedule + directions.',
      tags: ['re', 'ai', 'tool'],
      revenue: 'Part of Agent Assistant or standalone $29/mo',
      sections: {
        todo: [
          { text: 'Playwright booking script', done: true },
          { text: 'Route optimization with OSRM', done: true },
          { text: 'Package as OpenClaw skill', done: true },
          { text: 'Cancellation script', done: true },
          { text: 'Multi-showing batch booking', done: false },
          { text: 'Auto-email itinerary to buyer', done: false }
        ],
        idea: 'Agent gives addresses + time window. System optimizes route (OSRM API), logs into ShowingTime via Playwright, schedules each showing in optimal order, sends professional email to buyer with the plan.',
        plan: 'Tech: Playwright + OSRM routing API + Nominatim geocoding (all free)\nScript: /root/clawd/skills/showingtime-booking/\nFlow: Login ‚Üí search ‚Üí select listing ‚Üí pick time ‚Üí set end time ‚Üí Request Appointment ‚Üí CONFIRMED\nExecution: ~30 seconds per booking',
        resources: 'APIs & Services:\n- OSRM routing API (free) ‚úÖ\n- Nominatim/Photon geocoding (free) ‚úÖ\n- Playwright + Chromium ‚úÖ\n\nCredentials (per agent):\n- ShowingTime login\n\nInfrastructure:\n- DO server (already running) ‚úÖ\n\nAll resources acquired ‚Äî this is DONE.',
        info: 'ShowingTime URL: apptcenter.showingdesk.com\nKey selectors: #UserName, #Password, button[type=submit]\nScheduling iframe: scheduling.showingtime.com (cross-origin, Playwright handles it)\nTested: MLS #1327440, 3435 Alliance Dr, Springdale AR',
        notes: 'COMPLETE as of Feb 12, 2026. Packaged as OpenClaw skill. Successfully tested live booking.'
      }
    },
    {
      id: 'voice-notes-crm', column: 'ideas', emoji: 'üéôÔ∏è',
      title: 'Post-Showing Voice Notes ‚Üí CRM',
      desc: 'After each showing, agent records 30-sec voice note. AI transcribes, extracts sentiment + concerns + follow-up dates, pushes to CRM automatically.',
      tags: ['re', 'ai', 'voice'],
      revenue: 'Part of Agent Assistant',
      sections: {
        todo: [
          { text: 'Design voice prompt flow', done: false },
          { text: 'Build Deepgram transcription pipeline', done: false },
          { text: 'AI extraction (sentiment, follow-ups, concerns)', done: false },
          { text: 'Follow Up Boss API integration', done: false }
        ],
        idea: 'After showing a property, the app prompts: "How was the showing at [address]?" Agent talks naturally for 30 seconds.\n\nAI transcribes and extracts:\n- Client sentiment (positive/negative/neutral)\n- Specific concerns mentioned\n- Likely offer range\n- Action items / follow-up dates\n\nPushes structured data to CRM. No typing. No forgetting. Captured while fresh.',
        plan: '',
        resources: 'APIs & Services:\n- Deepgram STT (already integrated) ‚úÖ\n- Follow Up Boss REST API (per-agent key)\n- OpenAI or Claude for extraction\n\nCredentials (per agent):\n- Follow Up Boss API key\n\nCost:\n- Deepgram: ~$0.0043/min\n- OpenAI extraction: ~$0.01/note',
        info: 'Deepgram STT already integrated in CFill.\nFollow Up Boss has a REST API.\nCould use OpenAI/Claude for extraction.',
        notes: ''
      }
    },
    {
      id: 'cfill', column: 'launched', emoji: 'üìù',
      title: 'CFill ‚Äî Voice-to-Contract',
      desc: 'Voice-driven contract filling for real estate. Agent answers questions by voice, Playwright fills FormSimplicity. 60 questions, hybrid manual mode.',
      tags: ['re', 'ai', 'voice'],
      revenue: 'Beta ‚Äî deployed on Render + DO',
      sections: {
        todo: [
          { text: 'Voice interview flow', done: true },
          { text: 'FormSimplicity Playwright filling', done: true },
          { text: 'Multi-user support', done: true },
          { text: 'MLS sheet upload (Gemini)', done: true },
          { text: 'Client contacts fuzzy matching', done: true },
          { text: 'Android mic debugging', done: false },
          { text: 'William & Adam credential fix', done: false }
        ],
        idea: 'Voice-first contract writing. Agent answers 60 questions by voice, system fills the FormSimplicity contract automatically. Hybrid mode: mic + text for non-choice fields.',
        plan: 'Voice App (Render) ‚Üí POST /fill-contract ‚Üí DO microservice (Playwright)\nRepo: github.com/bac1876/cfill-voice-app.git\nMicroservice: 143.110.233.145:3100',
        info: 'Voice app: https://cfill-voice-app.onrender.com\nService: http://143.110.233.145:3100\nDB: SQLite with AES-256-CBC encrypted creds\n60 questions including buyer agency fees\nDeepgram Nova-2 + Flux STT, Aura-2 TTS',
        notes: 'Team: Brian (working), William, Nathan (Android mic), Adam, Carl\nv90+ ‚Äî mature product'
      }
    },
    {
      id: 'coaching-app', column: 'launched', emoji: 'üß†',
      title: 'Ultimate Coaching App',
      desc: 'Coaching OS for Brian\'s practice. Client profiles, Avatar (4 bodies), 6 Areas of Life, values, Fireflies transcription, AI analysis, homework tracker.',
      tags: ['coach', 'ai', 'saas'],
      revenue: 'Deployed on Railway',
      sections: {
        todo: [
          { text: 'Client profiles + Avatar', done: true },
          { text: '6 Areas of Life framework', done: true },
          { text: 'Fireflies transcription', done: true },
          { text: 'AI analysis (limiting beliefs, parts)', done: true },
          { text: 'Homework tracker with dual verification', done: true }
        ],
        idea: 'Full coaching OS based on Brian\'s 25-year methodology.\n\n6 Areas: Spirituality, Family, Career, Physical Health, Personal Growth, Relationships\nAvatar: 4 bodies (Spiritual, Mental, Emotional, Physical) ‚Äî "I am" statements\nProcess: Pick area ‚Üí Breakthrough ‚Üí CE ‚Üí Avatar ‚Üí Aim ‚Üí SMART goals ‚Üí 6+ months',
        plan: 'React + Vite frontend, Node.js/Express + Socket.IO backend, PostgreSQL\nFrontend: coaching-frontend-production.up.railway.app\nBackend: coaching-api-production-27c4.up.railway.app',
        info: 'Railway deployment, OpenAI API for analysis, Fireflies API for transcription',
        notes: 'Fully deployed and functional.'
      }
    },
    {
      id: 'ai-staging', column: 'ideas', emoji: 'üè°',
      title: 'AI Virtual Staging + Vendor Marketplace',
      desc: 'Upload empty room photos ‚Üí AI generates staged versions. Marketplace connects agents with staging vendors, photographers, cleaners.',
      tags: ['re', 'ai', 'saas'],
      revenue: '$29-49/mo + vendor referral fees',
      sections: { todo: [], idea: '', plan: '', info: '', notes: '' }
    },
    {
      id: 'seller-net-sheet', column: 'ideas', emoji: 'üí∞',
      title: 'AI Seller Net Sheet',
      desc: 'Auto-calculate seller proceeds. Pull comp data, estimate closing costs, show net after commissions + repairs. PDF/email to clients.',
      tags: ['re', 'ai', 'tool'],
      revenue: '$19-29/mo',
      sections: { todo: [], idea: '', plan: '', info: '', notes: '' }
    },
    {
      id: 'inspection-eval', column: 'ideas', emoji: 'üîç',
      title: 'Home Inspection Evaluation + Vendor Matching',
      desc: 'Upload inspection report ‚Üí AI summarizes issues by severity. Matches with local vendors for repairs. Auto-estimates repair costs.',
      tags: ['re', 'ai', 'saas'],
      revenue: '$29-49/mo + vendor referral fees',
      sections: { todo: [], idea: '', plan: '', info: '', notes: '' }
    },
    {
      id: 'contract-summary', column: 'ideas', emoji: 'üìÑ',
      title: 'Contract Summary Generator',
      desc: 'Upload any real estate contract ‚Üí AI generates plain-English summary. Highlights key dates, contingencies, obligations. Email to clients.',
      tags: ['re', 'ai', 'tool'],
      revenue: '$19-29/mo',
      sections: { todo: [], idea: '', plan: '', info: '', notes: '' }
    },
    {
      id: 'virtual-tour', column: 'ideas', emoji: 'üé¨',
      title: 'AI Virtual Tour Generator',
      desc: 'Upload photos ‚Üí AI creates interactive 3D-like tour. Depth maps on MLS photos ‚Üí "look around" per room. 60-second setup.',
      tags: ['re', 'ai', 'tool'],
      revenue: '$29-49/mo or per-tour pricing',
      sections: {
        todo: [],
        idea: 'Turn MLS photos into interactive tours in 60 seconds.\n\nSweet spot: depth estimation on standard photos ‚Üí interactive "look around" per room ‚Üí guided tour experience.',
        plan: 'Tech options: Gaussian Splatting, NeRF, Blockade Labs, Luma AI\nTiers:\n1. Many-photo 3D reconstruction (doable today)\n2. Single-photo 360¬∞ (partially doable)\n3. Full Matterport from few photos (not yet feasible)',
        info: 'Research done Feb 12, 2026. Depth estimation models are improving rapidly.',
        notes: ''
      }
    },
    {
      id: 'goal-tracker', column: 'ideas', emoji: 'üìä',
      title: 'Agent Goal Tracker / Accountability',
      desc: 'Yearly GCI goal ‚Üí monthly closings ‚Üí weekly activities ‚Üí daily actions. Brian\'s coaching framework as a daily check-in tool.',
      tags: ['re', 'coach', 'saas'],
      revenue: '$19-39/mo ‚Äî Part of Agent Assistant',
      sections: { todo: [], idea: '', plan: '', info: '', notes: '' }
    },
    {
      id: 'fitness-app', column: 'ideas', emoji: 'üí™',
      title: 'Fitness Photo Journal + Tracker',
      desc: 'Photo journal for body progress + workout tracker + diet tracker + 1RM tracker. Found on r/SomebodyMakeThis. Mockup created.',
      tags: ['saas', 'tool'],
      revenue: '$9.99/mo subscription',
      sections: {
        todo: [],
        idea: 'Photo journal + workout + diet + 1RM tracker all in one app.',
        plan: '',
        info: 'Mockup: /root/clawd/projects/ai-ideas/fitness-app-mockup.html\nFound on r/SomebodyMakeThis',
        notes: '3-screen HTML mockup built.'
      }
    },
    {
      id: 'testimonial-widget', column: 'ideas', emoji: '‚≠ê',
      title: 'Testimonial Collector & Widget',
      desc: 'Business sends link to customers ‚Üí they leave testimonial ‚Üí embeddable widget on website. Testimonial.to does $25K+/mo.',
      tags: ['saas', 'tool'],
      revenue: '$19-49/mo',
      sections: { todo: [], idea: '', plan: '', info: '', notes: '' }
    },
    {
      id: 'review-tool', column: 'ideas', emoji: 'üì±',
      title: 'Google Review Request Automation',
      desc: 'After a job, enter customer info ‚Üí auto-sends "please leave us a review" with direct Google link. Dashboard tracks reviews.',
      tags: ['saas', 'tool'],
      revenue: '$29-49/mo per business',
      sections: { todo: [], idea: '', plan: '', info: '', notes: '' }
    },
    {
      id: 'heroes-rpg', column: 'building', emoji: '‚öîÔ∏è',
      title: 'Heroes RPG (Mobile Game)',
      desc: '3D turn-based strategy RPG inspired by Heroes of Might and Magic. Unity, 7 worlds, 84 maps, 6-8 hero classes. iOS + Android.',
      tags: ['game'],
      revenue: 'In-app purchases + ads',
      sections: {
        todo: [
          { text: 'Unity project setup', done: true },
          { text: 'Core scripts', done: false },
          { text: '7 worlds design', done: false },
          { text: 'Combat system', done: false },
          { text: 'Asset integration', done: false }
        ],
        idea: '3D turn-based strategy RPG inspired by Heroes of Might and Magic.\n7 worlds (forest, volcanic, frozen, desert, shadow, crystal, celestial)\n12 maps per world = 84 total\n6-8 hero classes, equipment system, Gold + Gems economy',
        plan: 'Unity 6000.3.6f1 (C#)\nPlatform: iOS + Android\nAssets: $2 Unity bundle (Fantasy RPG GUI, Medieval Heroes, etc.)\nBrian\'s GPU: AMD Radeon RX 7900 XTX (24GB)',
        info: 'Location: C:\\Users\\Owner\\Claude Code Projects\\HeroesRPG\nReference: G:\\Dropbox\\A-Store\\p1-p18.PNG',
        notes: 'Brian rejected 2D ‚Üí wants full 3D like M&M: Era of Chaos'
      }
    },
    {
      id: 'cma-builder', column: 'ideas', emoji: 'üìä',
      title: 'CMA Builder',
      desc: 'Agent provides 3-5 MLS sheets ‚Üí AI creates professional Comparative Market Analysis document. Branded to team.',
      tags: ['re', 'ai', 'tool'],
      revenue: 'Part of Agent Assistant',
      sections: {
        todo: [],
        idea: 'Upload MLS sheets (PDFs or data) ‚Üí AI generates professional CMA.\nBranded to team, ready to present to seller.',
        plan: '', info: '', notes: 'New feature from Brian\'s Feb 12 expansion.'
      }
    },
    {
      id: 'listing-websites', column: 'ideas', emoji: 'üåê',
      title: 'Professional Listing Websites',
      desc: 'Upload MLS photos + data ‚Üí generates professional single-property website. Branded to team, seller can share on socials.',
      tags: ['re', 'ai', 'saas'],
      revenue: 'Part of Agent Assistant',
      sections: {
        todo: [],
        idea: 'Auto-generate professional single-property websites from MLS photos + data.\nBranded to team (Keller Williams / Curtis Tribe).\nSeller gets access to share on their socials.\nClean, modern design with photo gallery, details, map, agent contact.',
        plan: '', info: '', notes: 'New feature from Brian\'s Feb 12 expansion.'
      }
    },
    {
      id: 'nearby-alerts', column: 'ideas', emoji: 'üìç',
      title: 'Nearby Listing Alerts + Seller Impact',
      desc: 'Monitor properties within 1 mile of active listings. When something lists/sells/goes pending ‚Üí email seller with impact analysis.',
      tags: ['re', 'ai', 'tool'],
      revenue: 'Part of Agent Assistant',
      sections: {
        todo: [],
        idea: 'Agent sets up: "watch properties within 1 mile of [my listing]"\nWhen new property is listed, goes pending, or sells ‚Üí seller gets email.\nEmail includes impact analysis on their home\'s value.\nKeeps seller engaged and informed (builds trust).',
        plan: '', info: '', notes: 'New feature from Brian\'s Feb 12 expansion.'
      }
    },
    {
      id: 'docusign', column: 'onhold', emoji: '‚úçÔ∏è',
      title: 'DocuSign Integration',
      desc: 'Monitor DocuSign envelopes ‚Üí Telegram/Discord notifications. Replace Zapier.',
      tags: ['re', 'tool'],
      revenue: 'Internal tool ‚Äî saves Zapier costs',
      sections: {
        todo: [
          { text: 'Developer account created', done: true },
          { text: 'Go-Live form submitted', done: true },
          { text: 'Await approval', done: false },
          { text: 'Build envelope monitor', done: false }
        ],
        idea: '', plan: '',
        info: 'Integration Key: 2ef2bbc9-78d2-4820-a8ce-25b649d8aabd\nUser ID: 0ba19ebb-f19e-42fa-811a-037610b7299d\nAccount ID: 45500408',
        notes: 'Submitted 01/29/2026, pending approval.'
      }
    },
    {
      id: 'reddit-leads', column: 'planning', emoji: 'üéØ',
      title: 'Reddit Lead Generation',
      desc: 'High-trust lead gen for 126 Coaching using Reddit + AI automation. Karma building ‚Üí community integration ‚Üí SEO/AI visibility.',
      tags: ['coach', 'ai'],
      revenue: 'Lead gen for coaching practice',
      sections: {
        todo: [
          { text: 'Reddit account setup', done: false },
          { text: 'Karma building phase', done: false },
          { text: 'Community integration', done: false },
          { text: 'AI automation layer', done: false }
        ],
        idea: '', plan: '',
        info: 'Source: G:\\dropbox\\a-store\\REddit for Lead Gen.docx\nProject: /root/clawd/projects/reddit-lead-gen/',
        notes: ''
      }
    },
    {
      id: 'crg-showings', column: 'building', emoji: 'üìß',
      title: 'CRG Showings ‚Äî Email-to-Booking Service',
      desc: 'Agent emails addresses to CRGShowings@gmail.com ‚Üí system books ShowingTime, optimizes route, captures MLS data, sends confirmation. Feeds into CFill.',
      tags: ['re', 'ai', 'saas'],
      revenue: 'Part of Agent Assistant ‚Äî core automation',
      sections: {
        todo: [
          { text: 'Smart scheduling algorithm (15 min + drive times)', done: true },
          { text: 'Route optimization (OSRM)', done: true },
          { text: 'Email parser (natural language dates/times)', done: true },
          { text: 'Agent database (SQLite + AES encryption)', done: true },
          { text: 'CRGShowings@gmail.com OAuth setup', done: true },
          { text: 'ShowingTime Playwright booking', done: true },
          { text: 'End-to-end dry run test', done: true },
          { text: 'Live booking test with real email', done: false },
          { text: 'MLS data capture ‚Üí CFill integration', done: false },
          { text: 'Gmail API on server (24/7 autonomous monitoring)', done: false },
          { text: 'Confirmation email with route map', done: false },
          { text: 'Agent onboarding flow (self-registration)', done: false }
        ],
        idea: 'Agent sends one email with addresses ‚Üí gets back confirmed showings + optimized route + MLS data pre-loaded in CFill.\n\nThe full loop:\n1. Email addresses to CRGShowings@gmail.com\n2. System identifies agent by sender email\n3. Looks up their ShowingTime credentials\n4. Optimizes route (OSRM ‚Äî free)\n5. Calculates smart schedule (15 min minimum + drive times, round down to 15-min slots, 1 hour bookings)\n6. Playwright books each showing on ShowingTime\n7. Captures MLS data from each listing\n8. Sends confirmation email with full itinerary\n9. Pushes MLS data to CFill for contract pre-fill',
        plan: 'Architecture:\n- Agent DB: SQLite + AES-256 encrypted credentials\n- Email: CRGShowings@gmail.com (gog OAuth on Brian-PC, future: Gmail API on server)\n- Geocoding: Photon + Nominatim fallback (free)\n- Routing: OSRM (free)\n- Booking: Playwright + Chromium (headless)\n- Server: DO droplet (143.110.233.145)\n\nSmart Scheduling:\n- 15 min minimum at each property\n- Drive time from OSRM between stops\n- Round DOWN to nearest 15-min ShowingTime slot\n- Each booking = 1 hour (seller benefit)\n- Agent always arrives AFTER booking window opens',
        resources: 'APIs & Services:\n- OSRM routing (free) ‚úÖ\n- Photon/Nominatim geocoding (free) ‚úÖ\n- Playwright + Chromium ‚úÖ\n- Gmail via gog CLI ‚úÖ\n- chrono-node for date parsing ‚úÖ\n- better-sqlite3 ‚úÖ\n\nCredentials:\n- CRGShowings@gmail.com (OAuth on Brian-PC) ‚úÖ\n- Per-agent ShowingTime creds (stored encrypted)\n\nInfrastructure:\n- DO server ‚úÖ\n- Node.js + npm ‚úÖ\n\nNeeded:\n- Gmail API refresh token on server (for 24/7 monitoring)\n- PM2 process management\n- Agent onboarding UI or form',
        info: 'Project: /root/clawd/projects/crg-showings/\nFiles:\n- schedule-showings.js ‚Äî smart scheduling + route optimization + booking\n- agent-db.js ‚Äî agent database with encrypted creds\n- email-parser.js ‚Äî natural language email parsing\n- process-inbox.js ‚Äî end-to-end email processor\n- gmail-client.js ‚Äî local gog Gmail wrapper\n- gmail-via-node.js ‚Äî remote Gmail via Brian-PC\n\nDB: crg-showings.db\nAgent #1: Brian Curtis (brian@searchnwa.com)',
        notes: 'Built Feb 12, 2026. Full pipeline working in dry-run mode.\nBrian\'s vision: combine with CFill so MLS data flows into contracts automatically.\nKey insight: email is zero-friction interface ‚Äî agents already email, no app to learn.'
      }
    }
  ]
};

// ===== STATE =====
let data = JSON.parse(localStorage.getItem('kanban-v2')) || defaultData;
let currentCardId = null;
let activeSection = 'todo';

// Migrate old cards without sections
data.cards.forEach(card => {
  if (!card.sections) {
    card.sections = { todo: [], idea: '', plan: '', info: '', notes: '' };
  }
  SECTIONS.forEach(s => {
    if (card.sections[s] === undefined) {
      card.sections[s] = s === 'todo' ? [] : '';
    }
  });
});

function save() {
  localStorage.setItem('kanban-v2', JSON.stringify(data));
  render();
}

// ===== RENDER BOARD =====
function render() {
  const board = document.getElementById('board');
  board.innerHTML = '';

  const counts = {};
  Object.keys(data.columns).forEach(col => counts[col] = 0);
  data.cards.forEach(card => counts[card.column] = (counts[card.column] || 0) + 1);

  document.getElementById('stats').innerHTML = `
    <div class="stat"><div class="stat-value">${data.cards.length}</div><div class="stat-label">Total Ideas</div></div>
    <div class="stat"><div class="stat-value">${counts.ideas || 0}</div><div class="stat-label">Ideas</div></div>
    <div class="stat"><div class="stat-value">${counts.planning || 0}</div><div class="stat-label">Planning</div></div>
    <div class="stat"><div class="stat-value">${counts.building || 0}</div><div class="stat-label">Building</div></div>
    <div class="stat"><div class="stat-value">${counts.launched || 0}</div><div class="stat-label">Launched</div></div>
  `;

  Object.entries(data.columns).forEach(([colId, col]) => {
    const colEl = document.createElement('div');
    colEl.className = 'column';
    const cards = data.cards.filter(c => c.column === colId);
    colEl.innerHTML = `
      <div class="column-header">
        <div class="column-title">${col.title} <span class="column-count">${cards.length}</span></div>
      </div>
      <div class="column-body" data-column="${colId}">
        <div class="drop-zone" data-column="${colId}">Drop here</div>
        ${cards.map(renderCard).join('')}
      </div>
    `;
    board.appendChild(colEl);
  });

  setupDragDrop();
  document.getElementById('updated').textContent = 'Last updated: ' + new Date().toLocaleString();
}

function renderCard(card) {
  const tagMap = {
    re: ['Real Estate', 'tag-re'], ai: ['AI', 'tag-ai'], voice: ['Voice', 'tag-voice'],
    saas: ['SaaS', 'tag-saas'], game: ['Game', 'tag-game'],
    coach: ['Coaching', 'tag-coach'], tool: ['Tool', 'tag-tool']
  };
  const tags = (card.tags || []).map(t => {
    const [label, cls] = tagMap[t] || [t, 'tag-tool'];
    return `<span class="tag ${cls}">${label}</span>`;
  }).join('');
  const revenue = card.revenue ? `<div class="card-revenue">üí∞ ${card.revenue}</div>` : '';

  // Section badges
  let badges = '';
  if (card.sections) {
    const activeSections = [];
    if (card.sections.todo?.length) activeSections.push('todo');
    SECTIONS.filter(s => s !== 'todo').forEach(s => {
      if (card.sections[s]) activeSections.push(s);
    });
    if (activeSections.length) {
      badges = '<div class="card-sections-preview">' +
        activeSections.map(s => `<span class="section-badge section-badge-${s}">${s}</span>`).join('') +
        '</div>';
    }
  }

  // Todo progress
  let todoProgress = '';
  if (card.sections?.todo?.length) {
    const done = card.sections.todo.filter(t => t.done).length;
    const total = card.sections.todo.length;
    todoProgress = `<div style="font-size:10px;color:#4ade80;margin-top:4px;">‚úÖ ${done}/${total} tasks</div>`;
  }

  return `
    <div class="card" draggable="true" data-id="${card.id}" onclick="openDetail('${card.id}')">
      <div class="card-emoji">${card.emoji || 'üí°'}</div>
      <div class="card-title">${card.title}</div>
      <div class="card-desc">${card.desc}</div>
      <div class="card-tags">${tags}</div>
      ${todoProgress}
      ${revenue}
      ${badges}
    </div>
  `;
}

// ===== DRAG & DROP =====
function setupDragDrop() {
  document.querySelectorAll('.card').forEach(card => {
    card.addEventListener('dragstart', e => {
      e.stopPropagation();
      card.classList.add('dragging');
      e.dataTransfer.setData('text/plain', card.dataset.id);
      setTimeout(() => document.querySelectorAll('.drop-zone').forEach(z => z.classList.add('active')), 0);
    });
    card.addEventListener('dragend', () => {
      card.classList.remove('dragging');
      document.querySelectorAll('.drop-zone').forEach(z => z.classList.remove('active'));
    });
  });

  document.querySelectorAll('.column-body').forEach(body => {
    body.addEventListener('dragover', e => { e.preventDefault(); body.style.background = 'rgba(249,115,22,0.05)'; });
    body.addEventListener('dragleave', () => { body.style.background = ''; });
    body.addEventListener('drop', e => {
      e.preventDefault(); body.style.background = '';
      const cardId = e.dataTransfer.getData('text/plain');
      const card = data.cards.find(c => c.id === cardId);
      if (card) { card.column = body.dataset.column; save(); }
    });
  });
}

// ===== CARD DETAIL =====
function openDetail(cardId) {
  currentCardId = cardId;
  activeSection = 'todo';
  const card = data.cards.find(c => c.id === cardId);
  if (!card) return;
  renderDetail(card);
  document.getElementById('detailModal').classList.add('show');
}

function closeDetail() {
  // Save any open textarea content
  saveCurrentSection();
  document.getElementById('detailModal').classList.remove('show');
  currentCardId = null;
  save();
}

function renderDetail(card) {
  const colColors = { ideas: '#fbbf24', planning: '#3b82f6', building: '#f97316', launched: '#22c55e', onhold: '#666' };
  const colName = data.columns[card.column]?.title || card.column;
  const colColor = colColors[card.column] || '#666';

  let html = `
    <div class="detail-header">
      <div class="detail-emoji">${card.emoji || 'üí°'}</div>
      <div class="detail-title-wrap">
        <input class="detail-title" value="${escHtml(card.title)}" onchange="updateCardField('title', this.value)" />
        <span class="detail-column-badge" style="background:${colColor}22;color:${colColor}">${colName}</span>
      </div>
    </div>
    <textarea class="detail-desc" onchange="updateCardField('desc', this.value)" placeholder="Short description...">${escHtml(card.desc)}</textarea>

    <div class="section-tabs">
      ${SECTIONS.map(s => `
        <div class="section-tab ${s === activeSection ? 'active' : ''}" data-section="${s}" onclick="switchSection('${s}')">
          ${SECTION_LABELS[s]}
          ${s === 'todo' && card.sections.todo?.length ? `<span style="opacity:0.5;margin-left:4px;">(${card.sections.todo.filter(t=>t.done).length}/${card.sections.todo.length})</span>` : ''}
        </div>
      `).join('')}
    </div>

    <div id="sectionBody"></div>

    <div class="detail-meta">
      <label>Tags:</label>
      <input id="detailTags" value="${(card.tags||[]).join(', ')}" onchange="updateCardField('tags', this.value.split(',').map(t=>t.trim()).filter(Boolean))" placeholder="ai, saas, re, voice, coach, game, tool" />
      <label>üí∞</label>
      <input id="detailRevenue" value="${escHtml(card.revenue||'')}" onchange="updateCardField('revenue', this.value)" placeholder="Revenue potential" style="min-width:200px;" />
    </div>
    <div class="detail-meta">
      <label>Column:</label>
      <select onchange="updateCardField('column', this.value)" style="min-width:140px;">
        ${Object.entries(data.columns).map(([id,col]) => `<option value="${id}" ${card.column===id?'selected':''}>${col.title}</option>`).join('')}
      </select>
      <label>Emoji:</label>
      <input value="${card.emoji||'üí°'}" onchange="updateCardField('emoji', this.value)" style="width:60px;text-align:center;" />
    </div>

    <div class="detail-footer">
      <button class="btn btn-danger btn-sm" onclick="deleteCard('${card.id}')">üóëÔ∏è Delete Card</button>
      <button class="btn btn-primary btn-sm" onclick="closeDetail()">Done</button>
    </div>
  `;

  document.getElementById('detailContent').innerHTML = html;
  renderSectionBody(card);
}

function renderSectionBody(card) {
  const body = document.getElementById('sectionBody');
  if (!body) return;

  if (activeSection === 'todo') {
    const todos = card.sections.todo || [];
    body.innerHTML = `
      <ul class="todo-list">
        ${todos.map((t, i) => `
          <li class="todo-item ${t.done ? 'done' : ''}">
            <button class="todo-check ${t.done ? 'checked' : ''}" onclick="toggleTodo(${i})">‚úì</button>
            <span class="todo-text">${escHtml(t.text)}</span>
            <button class="todo-delete" onclick="deleteTodo(${i})">‚úï</button>
          </li>
        `).join('')}
      </ul>
      <div class="add-todo">
        <input type="text" id="newTodoInput" placeholder="Add a task..." onkeydown="if(event.key==='Enter')addTodo()" />
        <button class="btn btn-sm" onclick="addTodo()">+ Add</button>
      </div>
    `;
  } else {
    const content = card.sections[activeSection] || '';
    const placeholder = SECTION_PLACEHOLDERS[activeSection] || 'Write something...';
    body.innerHTML = `
      <textarea class="section-textarea" id="sectionText" placeholder="${placeholder}"
        onchange="updateSection('${activeSection}', this.value)">${escHtml(content)}</textarea>
    `;
  }
}

function switchSection(section) {
  saveCurrentSection();
  activeSection = section;
  const card = data.cards.find(c => c.id === currentCardId);
  if (!card) return;
  document.querySelectorAll('.section-tab').forEach(t => {
    t.classList.toggle('active', t.dataset.section === section);
  });
  renderSectionBody(card);
}

function saveCurrentSection() {
  if (!currentCardId) return;
  const card = data.cards.find(c => c.id === currentCardId);
  if (!card) return;
  if (activeSection !== 'todo') {
    const textarea = document.getElementById('sectionText');
    if (textarea) card.sections[activeSection] = textarea.value;
  }
  localStorage.setItem('kanban-v2', JSON.stringify(data));
}

function updateSection(section, value) {
  const card = data.cards.find(c => c.id === currentCardId);
  if (card) {
    card.sections[section] = value;
    localStorage.setItem('kanban-v2', JSON.stringify(data));
  }
}

function updateCardField(field, value) {
  const card = data.cards.find(c => c.id === currentCardId);
  if (card) {
    card[field] = value;
    localStorage.setItem('kanban-v2', JSON.stringify(data));
  }
}

// ===== TODO OPERATIONS =====
function toggleTodo(index) {
  const card = data.cards.find(c => c.id === currentCardId);
  if (card && card.sections.todo[index]) {
    card.sections.todo[index].done = !card.sections.todo[index].done;
    localStorage.setItem('kanban-v2', JSON.stringify(data));
    renderSectionBody(card);
  }
}

function addTodo() {
  const input = document.getElementById('newTodoInput');
  const text = input?.value.trim();
  if (!text) return;
  const card = data.cards.find(c => c.id === currentCardId);
  if (card) {
    card.sections.todo.push({ text, done: false });
    input.value = '';
    localStorage.setItem('kanban-v2', JSON.stringify(data));
    renderSectionBody(card);
  }
}

function deleteTodo(index) {
  const card = data.cards.find(c => c.id === currentCardId);
  if (card) {
    card.sections.todo.splice(index, 1);
    localStorage.setItem('kanban-v2', JSON.stringify(data));
    renderSectionBody(card);
  }
}

function deleteCard(cardId) {
  if (!confirm('Delete this card? This cannot be undone.')) return;
  data.cards = data.cards.filter(c => c.id !== cardId);
  closeDetail();
}

// ===== NEW IDEA MODAL =====
function openNewModal() {
  document.getElementById('newModal').classList.add('show');
  document.getElementById('newTitle').focus();
}
function closeNewModal() {
  document.getElementById('newModal').classList.remove('show');
  ['newTitle','newDesc','newTags','newRevenue'].forEach(id => document.getElementById(id).value = '');
}
function addIdea() {
  const title = document.getElementById('newTitle').value.trim();
  if (!title) return;
  data.cards.push({
    id: 'idea-' + Date.now(),
    column: document.getElementById('newColumn').value,
    emoji: 'üí°',
    title,
    desc: document.getElementById('newDesc').value.trim(),
    tags: document.getElementById('newTags').value.split(',').map(t => t.trim()).filter(Boolean),
    revenue: document.getElementById('newRevenue').value.trim() || null,
    sections: { todo: [], idea: '', plan: '', info: '', notes: '' }
  });
  closeNewModal();
  save();
}

// ===== EXPORT =====
function exportData() {
  let text = '# Brian\'s Ideas Board ‚Äî Export\\n\\n';
  Object.entries(data.columns).forEach(([colId, col]) => {
    const cards = data.cards.filter(c => c.column === colId);
    if (!cards.length) return;
    text += `## ${col.title} (${cards.length})\\n\\n`;
    cards.forEach(card => {
      text += `### ${card.emoji||'üí°'} ${card.title}\\n${card.desc}\\n`;
      if (card.revenue) text += `üí∞ ${card.revenue}\\n`;
      if (card.tags?.length) text += `Tags: ${card.tags.join(', ')}\\n`;
      if (card.sections) {
        if (card.sections.todo?.length) {
          text += '\\nTodo:\\n';
          card.sections.todo.forEach(t => text += `  ${t.done ? '‚úÖ' : '‚¨ú'} ${t.text}\\n`);
        }
        ['idea','plan','info','notes'].forEach(s => {
          if (card.sections[s]) text += `\\n${SECTION_LABELS[s]}:\\n${card.sections[s]}\\n`;
        });
      }
      text += '\\n';
    });
  });
  const blob = new Blob([text], { type: 'text/markdown' });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'ideas-board-export.md';
  a.click();
}

function escHtml(str) {
  if (!str) return '';
  return String(str).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}

document.addEventListener('keydown', e => {
  if (e.key === 'Escape') { closeDetail(); closeNewModal(); }
});

render();
</script>
</body>
</html>
